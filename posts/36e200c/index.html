<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>gurobi速查手册 | syuansheng's blogs</title><meta name="author" content="syuansheng"><meta name="copyright" content="syuansheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="整理实践过程中gurobi中相关操作。">
<meta property="og:type" content="article">
<meta property="og:title" content="gurobi速查手册">
<meta property="og:url" content="https://yuanshengshe.github.io/posts/36e200c/index.html">
<meta property="og:site_name" content="syuansheng&#39;s blogs">
<meta property="og:description" content="整理实践过程中gurobi中相关操作。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/cover.png">
<meta property="article:published_time" content="2025-07-26T05:54:35.000Z">
<meta property="article:modified_time" content="2025-07-26T12:11:30.000Z">
<meta property="article:author" content="syuansheng">
<meta property="article:tag" content="Gurobi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/cover.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "gurobi速查手册",
  "url": "https://yuanshengshe.github.io/posts/36e200c/",
  "image": "https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/cover.png",
  "datePublished": "2025-07-26T05:54:35.000Z",
  "dateModified": "2025-07-26T12:11:30.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "syuansheng",
      "url": "https://yuanshengshe.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/DMU.png"><link rel="canonical" href="https://yuanshengshe.github.io/posts/36e200c/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":"ture","top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'gurobi速查手册',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/myfooter.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/mygradient.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="web_bg" style="background-image: url(https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/顶部图/wallhaven-7j37v3_1920x1080.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/avatar3.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> Blogs</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/datasets/"><i class="fa-fw fas fa-list"></i><span> Datasets</span></a></div><div class="menus_item"><a class="site-page" href="/abouts/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">syuansheng's blogs</span></a><a class="nav-page-title" href="/"><span class="site-name">gurobi速查手册</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 搜索按钮--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><!-- 菜单项--><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> Blogs</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/datasets/"><i class="fa-fw fas fa-list"></i><span> Datasets</span></a></div><div class="menus_item"><a class="site-page" href="/abouts/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div><!-- 移动端汉堡菜单按钮（保持原位置）--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">gurobi速查手册</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-07-26T05:54:35.000Z" title="Created 2025-07-26 13:54:35">2025-07-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-07-26T12:11:30.000Z" title="Updated 2025-07-26 20:11:30">2025-07-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E4%B8%8E%E8%BF%90%E7%AD%B9%E5%AD%A6/">数学建模与运筹学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>14mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Gurobi中一些基本的概念"><a href="#Gurobi中一些基本的概念" class="headerlink" title="Gurobi中一些基本的概念"></a>Gurobi中一些基本的概念</h1><center>
        <img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/1.png" weight="50%" height="50%"> 
</center>

<ol>
<li><code>Parameters</code>：参数用于控制求解器的行为，<a target="_blank" rel="noopener" href="https://docs.gurobi.com/projects/optimizer/en/current/concepts/parameters/groups.html">相关参数参考</a>。</li>
<li><code>Attributes</code>：属性是查询和修改相关对象特征的机制，<a target="_blank" rel="noopener" href="https://docs.gurobi.com/projects/optimizer/en/current/concepts/attributes/types.html">相关属性参考</a>。</li>
<li><code>Environment</code>：环境是Model的容器，gurobi的python接口会自动创建环境。设置环境的Parameters会让环境中的每个Model都默认这些Parameters，也可以单独为每个模型设置Parameters。</li>
</ol>
<h1 id="使用Gurobi建模的一般步骤"><a href="#使用Gurobi建模的一般步骤" class="headerlink" title="使用Gurobi建模的一般步骤"></a>使用Gurobi建模的一般步骤</h1><center>
        <img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/2.png" weight="50%" height="50%"> 
</center>

<p>使用Gurobi求解优化模型比较有条理的步骤如下：</p>
<ol>
<li>先建模，建模可按以下步骤一步一步分析，避免脑袋绕晕<ol>
<li>定义模型中要使用的集合</li>
<li>定义模型中要使用的参数</li>
<li>定义模型中要使用的决策变量</li>
<li>定义模型的目标函数</li>
<li>分析模型应该包含的所有约束条件</li>
</ol>
</li>
<li>然后使用Gurobi求解，具体又可按以下步骤进行<ol>
<li>使用list或tuplelist对象保存集合（附：集合在模型中一般用作索引）</li>
<li>使用dict或tupledict对象保存参数</li>
<li>创建模型对象<ol>
<li>添加变量</li>
<li>设置目标函数</li>
<li>添加约束条件</li>
<li>进行优化</li>
</ol>
</li>
</ol>
</li>
</ol>
<div class="admonition info"><p class="admonition-title">tuplelist和tupledict数据结构与list和dict的区别是什么？
</p><p>前者是gurobi的内置数据结构，有更加强大的索引功能。</p>
</div>

<h1 id="操作速查"><a href="#操作速查" class="headerlink" title="操作速查"></a>操作速查</h1><h2 id="获取或修改模型的参数"><a href="#获取或修改模型的参数" class="headerlink" title="获取或修改模型的参数"></a>获取或修改模型的参数</h2><p>直接用Model对象的Params属性就可以实现gurobi中相关<a target="_blank" rel="noopener" href="https://docs.gurobi.com/projects/optimizer/en/current/concepts/parameters/groups.html">参数</a>的获取和修改。</p>
<ul>
<li>Termination parameters which set the stopping conditions for algorithms;</li>
<li>Tolerance parameters which control solution quality requirements;</li>
<li>Logging and I/O parameters which control logging behavior as well as input and output files;</li>
<li>Algorithmic control parameters for Presolve, Simplex, Barrier, Scaling, MIP, MIP Cuts, and Numerics;</li>
<li>Tuning parameters which control parameter tuning strategies for grbtune and the tune API calls;</li>
<li>Solution Pool parameters which control how the solver searches for and stores additional solutions other than the best available one;</li>
<li>Multi-Objective parameters which control some aspects when working with multiple objectives;</li>
<li>Parameters for configuring aspects of remote optimization and licensing: Parallel and Distributed Computing, Instant Cloud, Compute Server, Cluster Manager, Token Server, Web License Service; and</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>通过Model对象的Params属性修改参数的示范</span></div><code class="language-python">model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>MIPFocus <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 求解策略参数的设置</span>
model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>LogFile <span class="token operator">=</span> <span class="token string">'modelversion2.log'</span> <span class="token comment"># 求解日志存放位置</span>
model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>MIPGap <span class="token operator">=</span> <span class="token number">0.7</span> <span class="token comment"># 要求找到最优解，*测试的时候直接设置称60%的gap，真正要收敛到0太困难了，收到60%左右基本上就是最优解，利用这个技巧方便后面做灵敏度分析*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="获取或修改对象的属性"><a href="#获取或修改对象的属性" class="headerlink" title="获取或修改对象的属性"></a>获取或修改对象的属性</h2><p>获取对象<a target="_blank" rel="noopener" href="https://docs.gurobi.com/projects/optimizer/en/current/concepts/attributes/types.html#secattributetypes">属性</a>的话就用Model对象的getAttr方法就好了，设置对象属性则可以使用setAttr方法，<font color="green">当然了也可以使用面向对象的.属性名方式来访问或修改属性，缺点是批量操作得写循环</font>。这两个方法都有attrname和objects参数，当只提供属性名的时候，查询或设置的就是Model对象对应属性的值，如果提供了objects（通常是tuplelist或tupledict）这两个方法就查询和设置的是这些objects的属性值。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>gurobi获取或删除对象属性的示范</span></div><code class="language-python">main_model<span class="token punctuation">.</span>setAttr<span class="token punctuation">(</span><span class="token string">'VType'</span><span class="token punctuation">,</span>main_model<span class="token punctuation">.</span>getVars<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>GRB<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span> <span class="token comment"># 将main_model.getVars()获取到的所有变量的vtype属性设置为GRB.INTEGER。</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="使用quicksum函数和tupledict的sum方法完成求和操作"><a href="#使用quicksum函数和tupledict的sum方法完成求和操作" class="headerlink" title="使用quicksum函数和tupledict的sum方法完成求和操作"></a>使用quicksum函数和tupledict的sum方法完成求和操作</h2><p>quicksum一般的用法是里面写一个生成器推导式，得到所有要求和的项，与sum方法相比，quicksum函数更加灵活，可以实现变量与系数的加权求和。</p>
<script type="math/tex; mode=display">
\sum_{j\in J}x_{ij}\le5,\quad \forall i\in I</script><pre class="line-numbers language-python" data-language="python"><div class="caption"><span>quicksum函数和sum方法的示例</span></div><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> I<span class="token punctuation">:</span>
	model<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span>gp<span class="token punctuation">.</span>quicksum<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> J<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> I<span class="token punctuation">:</span>
	model<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>创建约束条件的时候实际上可以使用一种更加简单的写法，及在addConstrs方法内部写生成器推导式。上述的约束条件也可以写成：    </p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>另一种简便写法</span></div><code class="language-python">model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>gp<span class="token punctuation">.</span>quicksum<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token keyword">for</span> I <span class="token keyword">in</span> J<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> I<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> I<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="利用GRB减少不必要的记忆"><a href="#利用GRB减少不必要的记忆" class="headerlink" title="利用GRB减少不必要的记忆"></a>利用GRB减少不必要的记忆</h2><p>GRB类中定义了Gurobi中常用的一些常量，例如我想将求解策略参数设置为均衡模式，我当然可以写model.Params.MIPFocus = 0，但是0这个数字并没什么字面意义，时间一长你可能就忘了到底得把MIPFocus设置成几才是均衡模式了。使用GRB类中定义的常量你可以写成model.Params.MIPFocus=MIPFOCUS_BALANCED。</p>
<pre class="line-numbers language-plain" data-language="plain"><div class="caption"><span>GRB类中定义的常量</span></div><code class="language-plain"># Status codes

LOADED          = 1
OPTIMAL         = 2
INFEASIBLE      = 3
INF_OR_UNBD     = 4
UNBOUNDED       = 5
CUTOFF          = 6
ITERATION_LIMIT = 7
NODE_LIMIT      = 8
TIME_LIMIT      = 9
SOLUTION_LIMIT  = 10
INTERRUPTED     = 11
NUMERIC         = 12
SUBOPTIMAL      = 13
INPROGRESS      = 14
USER_OBJ_LIMIT  = 15
WORK_LIMIT      = 16
MEM_LIMIT       = 17

# Batch status codes

BATCH_CREATED   = 1
BATCH_SUBMITTED = 2
BATCH_ABORTED   = 3
BATCH_FAILED    = 4
BATCH_COMPLETED = 5

# Constraint senses

LESS_EQUAL    = '&lt;'
GREATER_EQUAL = '&gt;'
EQUAL         = '='

# Variable types

CONTINUOUS = 'C'
BINARY     = 'B'
INTEGER    = 'I'
SEMICONT   = 'S'
SEMIINT    = 'N'

# Objective sense

MINIMIZE = 1
MAXIMIZE = -1

# SOS types

SOS_TYPE1 = 1
SOS_TYPE2 = 2

# General constraint types

GENCONSTR_MAX       = 0
GENCONSTR_MIN       = 1
GENCONSTR_ABS       = 2
GENCONSTR_AND       = 3
GENCONSTR_OR        = 4
GENCONSTR_NORM      = 5
GENCONSTR_NL        = 6
GENCONSTR_INDICATOR = 7
GENCONSTR_PWL       = 8
GENCONSTR_POLY      = 9
GENCONSTR_EXP       = 10
GENCONSTR_EXPA      = 11
GENCONSTR_LOG       = 12
GENCONSTR_LOGA      = 13
GENCONSTR_POW       = 14
GENCONSTR_SIN       = 15
GENCONSTR_COS       = 16
GENCONSTR_TAN       = 17
GENCONSTR_LOGISTIC  = 18

# Operation codes
OPCODE_CONSTANT     = 0
OPCODE_VARIABLE     = 1
OPCODE_PLUS         = 2
OPCODE_MINUS        = 3
OPCODE_MULTIPLY     = 4
OPCODE_DIVIDE       = 5
OPCODE_UMINUS       = 6
OPCODE_SQUARE       = 7
OPCODE_SQRT         = 8
OPCODE_SIN          = 9
OPCODE_COS          = 10
OPCODE_TAN          = 11
OPCODE_POW          = 12
OPCODE_EXP          = 13
OPCODE_LOG          = 14
OPCODE_LOG2         = 15
OPCODE_LOG10        = 16
OPCODE_LOGISTIC     = 17

# Basis status

BASIC          = 0
NONBASIC_LOWER = -1
NONBASIC_UPPER = -2
SUPERBASIC     = -3

# Numeric constants

INFINITY  = 1e100
UNDEFINED = 1e101
MAXINT    = 2000000000

# Limits

MAX_NAMELEN    = 255
MAX_STRLEN     = 512
MAX_TAGLEN     = 10240
MAX_CONCURRENT = 64

# Other constants

DEFAULT_CS_PORT = 61000

# Version number

VERSION_MAJOR     = 12
VERSION_MINOR     = 0
VERSION_TECHNICAL = 0

# Errors

ERROR_OUT_OF_MEMORY            = 10001
ERROR_NULL_ARGUMENT            = 10002
ERROR_INVALID_ARGUMENT         = 10003
ERROR_UNKNOWN_ATTRIBUTE        = 10004
ERROR_DATA_NOT_AVAILABLE       = 10005
ERROR_INDEX_OUT_OF_RANGE       = 10006
ERROR_UNKNOWN_PARAMETER        = 10007
ERROR_VALUE_OUT_OF_RANGE       = 10008
ERROR_NO_LICENSE               = 10009
ERROR_SIZE_LIMIT_EXCEEDED      = 10010
ERROR_CALLBACK                 = 10011
ERROR_FILE_READ                = 10012
ERROR_FILE_WRITE               = 10013
ERROR_NUMERIC                  = 10014
ERROR_IIS_NOT_INFEASIBLE       = 10015
ERROR_NOT_FOR_MIP              = 10016
ERROR_OPTIMIZATION_IN_PROGRESS = 10017
ERROR_DUPLICATES               = 10018
ERROR_NODEFILE                 = 10019
ERROR_Q_NOT_PSD                = 10020
ERROR_QCP_EQUALITY_CONSTRAINT  = 10021
ERROR_NETWORK                  = 10022
ERROR_JOB_REJECTED             = 10023
ERROR_NOT_SUPPORTED            = 10024
ERROR_EXCEED_2B_NONZEROS       = 10025
ERROR_INVALID_PIECEWISE_OBJ    = 10026
ERROR_UPDATEMODE_CHANGE        = 10027
ERROR_CLOUD                    = 10028
ERROR_MODEL_MODIFICATION       = 10029
ERROR_CSWORKER                 = 10030
ERROR_TUNE_MODEL_TYPES         = 10031
ERROR_SECURITY                 = 10032
ERROR_NOT_IN_MODEL             = 20001
ERROR_FAILED_TO_CREATE_MODEL   = 20002
ERROR_INTERNAL                 = 20003

# Cuts parameter values

CUTS_AUTO           = -1
CUTS_OFF            = 0
CUTS_CONSERVATIVE   = 1
CUTS_AGGRESSIVE     = 2
CUTS_VERYAGGRESSIVE = 3

# Presolve parameter values

PRESOLVE_AUTO         = -1
PRESOLVE_OFF          = 0
PRESOLVE_CONSERVATIVE = 1
PRESOLVE_AGGRESSIVE   = 2

# Method parameter values

METHOD_NONE                             = -1
METHOD_AUTO                             = -1
METHOD_PRIMAL                           = 0
METHOD_DUAL                             = 1
METHOD_BARRIER                          = 2
METHOD_CONCURRENT                       = 3
METHOD_DETERMINISTIC_CONCURRENT         = 4
METHOD_DETERMINISTIC_CONCURRENT_SIMPLEX = 5

# BarHomogeneous parameter values

BARHOMOGENEOUS_AUTO = -1
BARHOMOGENEOUS_OFF  = 0
BARHOMOGENEOUS_ON   = 1

# BarOrder parameter values

BARORDER_AUTOMATIC        = -1
BARORDER_AMD              = 0
BARORDER_NESTEDDISSECTION = 1

# MIPFocus parameter values

MIPFOCUS_BALANCED    = 0
MIPFOCUS_FEASIBILITY = 1
MIPFOCUS_OPTIMALITY  = 2
MIPFOCUS_BESTBOUND   = 3

# SimplexPricing parameter values

SIMPLEXPRICING_AUTO           = -1
SIMPLEXPRICING_PARTIAL        = 0
SIMPLEXPRICING_STEEPEST_EDGE  = 1
SIMPLEXPRICING_DEVEX          = 2
SIMPLEXPRICING_STEEPEST_QUICK = 3

# VarBranch parameter values

VARBRANCH_AUTO           = -1
VARBRANCH_PSEUDO_REDUCED = 0
VARBRANCH_PSEUDO_SHADOW  = 1
VARBRANCH_MAX_INFEAS     = 2
VARBRANCH_STRONG         = 3

# Partition parameter values

PARTITION_EARLY     = 16
PARTITION_ROOTSTART = 8
PARTITION_ROOTEND   = 4
PARTITION_NODES     = 2
PARTITION_CLEANUP   = 1

# Callback phase values

PHASE_MIP_NOREL   = 0
PHASE_MIP_SEARCH  = 1
PHASE_MIP_IMPROVE = 2

# FeasRelax method parameter values

FEASRELAX_LINEAR      = 0
FEASRELAX_QUADRATIC   = 1
FEASRELAX_CARDINALITY = 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="通过回调函数插入惰性约束"><a href="#通过回调函数插入惰性约束" class="headerlink" title="通过回调函数插入惰性约束"></a>通过回调函数插入惰性约束</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Date    : 2025-05-04 10:26:02</span>
<span class="token comment"># @Author  : syuansheng (Dalian Maritime University)</span>
<span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span>List
<span class="token keyword">from</span> numpy <span class="token keyword">import</span> ndarray<span class="token punctuation">,</span>zeros
<span class="token keyword">from</span> gurobipy <span class="token keyword">import</span> Model<span class="token punctuation">,</span>GRB<span class="token punctuation">,</span>GurobiError<span class="token punctuation">,</span>quicksum

<span class="token keyword">def</span> <span class="token function">findAllSubroutes</span><span class="token punctuation">(</span>solution<span class="token punctuation">:</span>ndarray<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>Dict<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span>List<span class="token punctuation">[</span>List<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
	route_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># subtours of each car</span>
	<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		subtour_kcars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># subtours of car k</span>
		<span class="token comment"># check subtours of car k </span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>solution<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			flag <span class="token operator">=</span> <span class="token boolean">False</span> 
			subtour_kcars_start_i <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># subtours of car k that starts from point i </span>
			<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>solution<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token comment"># car k moved from point i to j</span>
				<span class="token keyword">if</span> solution<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.9</span><span class="token punctuation">:</span>
					subtour_kcars_start_i<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
					subtour_kcars_start_i<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
					current_point <span class="token operator">=</span> j 
					<span class="token comment"># cheack whether i-&gt;j formed a subtour</span>
					<span class="token keyword">while</span> <span class="token keyword">not</span> flag<span class="token punctuation">:</span>
						<span class="token keyword">for</span> next_point <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>solution<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
							<span class="token keyword">if</span> solution<span class="token punctuation">[</span>current_point<span class="token punctuation">,</span>next_point<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span>  <span class="token number">0.9</span><span class="token punctuation">:</span>
								subtour_kcars_start_i<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_point<span class="token punctuation">)</span>
								current_point <span class="token operator">=</span> next_point
							<span class="token comment"># we find a subtour start from ponstallint i</span>
							<span class="token keyword">if</span> subtour_kcars_start_i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> subtour_kcars_start_i<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
								flag <span class="token operator">=</span> <span class="token boolean">True</span>
								subtour_kcars<span class="token punctuation">.</span>append<span class="token punctuation">(</span>subtour_kcars_start_i<span class="token punctuation">)</span>
								<span class="token keyword">break</span>
							<span class="token comment"># car k finally arrived point (solution.shape[2]-1) means i-&gt;j didn't form a subtour</span>
							<span class="token keyword">if</span> current_point <span class="token operator">==</span> solution<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
								flag <span class="token operator">=</span> <span class="token boolean">True</span>
								<span class="token keyword">break</span>
				<span class="token keyword">else</span><span class="token punctuation">:</span>
					<span class="token keyword">continue</span>
		route_dict<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> subtour_kcars
	<span class="token keyword">return</span> route_dict

<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">:</span>

	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

		self<span class="token punctuation">.</span>o <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># index of the depot</span>
		self<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment"># index of the depot(duplication)</span>
		self<span class="token punctuation">.</span>C <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># index of each customer</span>
		self<span class="token punctuation">.</span>V <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>o<span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>C<span class="token operator">+</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>d<span class="token punctuation">]</span>
		self<span class="token punctuation">.</span>K <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># index of each car</span>
		self<span class="token punctuation">.</span>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># all valid arc</span>
		self<span class="token punctuation">.</span>Q <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment"># capacity of each car</span>
		self<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># distance between i to j</span>
		self<span class="token punctuation">.</span>q <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># demand of each customer</span>
		self<span class="token punctuation">.</span>loc <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># cordinate of each point	</span>

	<span class="token keyword">def</span> <span class="token function">getDataReady</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

		lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'./r101_CVRP.txt'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			str_lst <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> line <span class="token keyword">in</span> str_lst<span class="token punctuation">:</span>
				lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i<span class="token punctuation">,</span>item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span><span class="token punctuation">:</span>
			self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>item<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
			self<span class="token punctuation">.</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
			<span class="token keyword">for</span> j <span class="token keyword">in</span> self<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
				<span class="token comment"># exclude invalid arc</span>
				<span class="token keyword">if</span> i <span class="token operator">==</span> self<span class="token punctuation">.</span>d <span class="token keyword">or</span> j <span class="token operator">==</span> self<span class="token punctuation">.</span>o <span class="token keyword">or</span> i <span class="token operator">==</span> j <span class="token keyword">or</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> self<span class="token punctuation">.</span>o <span class="token keyword">and</span> j <span class="token operator">==</span> self<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">continue</span>
				<span class="token keyword">else</span><span class="token punctuation">:</span>
					self<span class="token punctuation">.</span>A<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>A<span class="token punctuation">:</span>
			<span class="token keyword">if</span> j <span class="token operator">==</span> self<span class="token punctuation">.</span>d<span class="token punctuation">:</span>
				self<span class="token punctuation">.</span>c<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>self<span class="token punctuation">.</span>o<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>self<span class="token punctuation">.</span>o<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				self<span class="token punctuation">.</span>c<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">VRPModel</span><span class="token punctuation">:</span>

	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>_model <span class="token operator">=</span> <span class="token boolean">None</span>
		self<span class="token punctuation">.</span>_data <span class="token operator">=</span> data
		self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">def</span> <span class="token function">buildModel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>_model <span class="token operator">=</span> Model<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'CVRP1_1'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>A<span class="token punctuation">,</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>BINARY<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
		<span class="token comment"># set objective function</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>setObjective<span class="token punctuation">(</span>
			quicksum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>c<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>A <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			sense<span class="token operator">=</span>GRB<span class="token punctuation">.</span>MINIMIZE
			<span class="token punctuation">)</span>
		<span class="token comment"># set constraints</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>C<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constraint1'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>o<span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>d<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constraint2'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>d<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">1</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constraint3'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>C <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constraint4'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>quicksum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>A<span class="token punctuation">)</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>Q <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span>  <span class="token string">'constraint5'</span>
			<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">solveModel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>MIPGap <span class="token operator">=</span> <span class="token number">0</span> 
			self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>lazyConstraints <span class="token operator">=</span> <span class="token number">1</span>
			self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>generateDFJConstraint<span class="token punctuation">)</span>
		<span class="token keyword">except</span> GurobiError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'erro number:{},erro string:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errno<span class="token punctuation">,</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">generateDFJConstraint</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>model<span class="token punctuation">,</span>where<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># each time when gurobi find a feasible solution,we check whether we should add some DFJ constraints</span>
		<span class="token keyword">if</span> where <span class="token operator">==</span>  GRB<span class="token punctuation">.</span>Callback<span class="token punctuation">.</span>MIPSOL<span class="token punctuation">:</span>
			solution <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># save the solution results in matrix format</span>
			<span class="token keyword">for</span> key<span class="token punctuation">,</span>value <span class="token keyword">in</span> self<span class="token punctuation">.</span>x<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				idx1<span class="token punctuation">,</span>idx2<span class="token punctuation">,</span>idx3 <span class="token operator">=</span> key
				solution<span class="token punctuation">[</span>idx1<span class="token punctuation">,</span>idx2<span class="token punctuation">,</span>idx3<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>cbGetSolution<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
			route_dict <span class="token operator">=</span> findAllSubroutes<span class="token punctuation">(</span>solution<span class="token punctuation">)</span>
			<span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>K<span class="token punctuation">:</span>
				<span class="token keyword">for</span> subtour_kcars_start_i <span class="token keyword">in</span> route_dict<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">:</span>
					<span class="token comment"># Now we get the set S(subtour_kcars_start_i[:-1])</span>
					self<span class="token punctuation">.</span>_model<span class="token punctuation">.</span>cbLazy<span class="token punctuation">(</span>
						quicksum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>A <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> subtour_kcars_start_i<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">and</span> j <span class="token keyword">in</span> subtour_kcars_start_i<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
						<span class="token operator">&lt;=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>subtour_kcars_start_i<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
						<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token punctuation">)</span>
	data<span class="token punctuation">.</span>getDataReady<span class="token punctuation">(</span><span class="token punctuation">)</span>
	model <span class="token operator">=</span> VRPModel<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	model<span class="token punctuation">.</span>buildModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
	model<span class="token punctuation">.</span>solveModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Gurobi实现列生成算法"><a href="#Gurobi实现列生成算法" class="headerlink" title="Gurobi实现列生成算法"></a>Gurobi实现列生成算法</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Date    : 2025-07-25 14:34:23</span>
<span class="token comment"># @Author  : syuansheng (Dalian Maritime University)</span>

<span class="token keyword">from</span> gurobipy <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token comment"># 需求类型</span>
		self<span class="token punctuation">.</span>L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token comment"># 可用原木的长度</span>
		self<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token comment"># 各种长度原木的价格</span>

<span class="token keyword">class</span> <span class="token class-name">CGModel</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment"># 初始化主模型</span>
		y <span class="token operator">=</span> self<span class="token punctuation">.</span>initiate_main_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment"># 初始化所有子模型</span>
		self<span class="token punctuation">.</span>initiate_sub_model<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">initiate_main_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>main_model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>CONTINUOUS<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>setObjective<span class="token punctuation">(</span>
			<span class="token number">5</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			sense <span class="token operator">=</span> GRB<span class="token punctuation">.</span>MINIMIZE
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">30</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">20</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">40</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment"># 获取对偶变量的值</span>
		y <span class="token operator">=</span> self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getAttr<span class="token punctuation">(</span><span class="token string">'Pi'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getConstrs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> y

	<span class="token keyword">def</span> <span class="token function">initiate_sub_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>submodels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token comment"># k子模型</span>
			submodel <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
			p <span class="token operator">=</span> submodel<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>INTEGER<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'p'</span><span class="token punctuation">)</span>
			submodel<span class="token punctuation">.</span>setObjective<span class="token punctuation">(</span>
				self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>c<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">-</span>quicksum<span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				sense<span class="token operator">=</span>GRB<span class="token punctuation">.</span>MINIMIZE
				<span class="token punctuation">)</span>
			submodel<span class="token punctuation">.</span>addConstr<span class="token punctuation">(</span>quicksum<span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>L<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
			self<span class="token punctuation">.</span>submodels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>submodel<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		不断更新主模型和子模型并求解，直到得到原模型的最优解
		"""</span>
		<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
			best_ObjVal<span class="token punctuation">,</span>best_P<span class="token punctuation">,</span>submodel_idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">0</span>
			<span class="token comment"># 求解子模型</span>
			<span class="token keyword">for</span> k<span class="token punctuation">,</span>submodel <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>submodels<span class="token punctuation">)</span><span class="token punctuation">:</span>
				submodel<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> submodel<span class="token punctuation">.</span>ObjVal <span class="token operator">&lt;</span> best_ObjVal<span class="token punctuation">:</span>
					<span class="token comment"># 说明存在列加入主模型后使得主模型更好</span>
					best_ObjVal <span class="token operator">=</span> submodel<span class="token punctuation">.</span>ObjVal <span class="token comment"># 子模型最优解目标函数值</span>
					best_P <span class="token operator">=</span> submodel<span class="token punctuation">.</span>X <span class="token comment"># 子模型最优解</span>
					submodel_idx <span class="token operator">=</span> k
			<span class="token comment"># 退出</span>
			<span class="token keyword">if</span> best_ObjVal <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">:</span>
				<span class="token keyword">break</span>
			<span class="token comment"># 将新的列添加到主模型中，求解主模型并更新子模型</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				col <span class="token operator">=</span> Column<span class="token punctuation">(</span>best_P<span class="token punctuation">,</span>self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getConstrs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 创建要加入到主模型的列</span>
				self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>addVar<span class="token punctuation">(</span>obj<span class="token operator">=</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>c<span class="token punctuation">[</span>submodel_idx<span class="token punctuation">]</span><span class="token punctuation">,</span>column<span class="token operator">=</span>col<span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>CONTINUOUS<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'new_x'</span><span class="token punctuation">)</span> <span class="token comment"># 将新的列加入主模型</span>
				self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 求解主模型</span>
				self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'ttest.lp'</span><span class="token punctuation">)</span>
				y <span class="token operator">=</span> self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getAttr<span class="token punctuation">(</span><span class="token string">'Pi'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getConstrs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 新的对偶变量值</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'----------------------------'</span><span class="token punctuation">,</span>y<span class="token punctuation">,</span>best_P<span class="token punctuation">,</span>submodel_idx<span class="token punctuation">)</span>
				self<span class="token punctuation">.</span>initiate_sub_model<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment"># 更新子模型</span>
		<span class="token comment"># 将模型转换为对应的IP模型继续求解</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>setAttr<span class="token punctuation">(</span><span class="token string">'VType'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>getVars<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>GRB<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	model <span class="token operator">=</span> CGModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
	model<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>ObjVal<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>main_model<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_50622644/article/details/145320250">Gurobi激活申请</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.gurobi.com/projects/optimizer/en/current/">Gurobi参考手册</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://YuanshengShe.github.io">syuansheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://yuanshengshe.github.io/posts/36e200c/">https://yuanshengshe.github.io/posts/36e200c/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Gurobi/">Gurobi</a></div><div class="post-share"><div class="social-share" data-image="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>点这里请我喝杯咖啡吧！</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/wechatreceive.jpg" target="_blank"><img class="post-qr-code-img" src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/wechatreceive.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/bfec5f03/" title="整数规划课程笔记（孙小玲主讲）"><img class="cover" src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/整数规划课程笔记（孙小玲教授主讲）/1.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">整数规划课程笔记（孙小玲主讲）</div></div><div class="info-2"><div class="info-item-1">单纯形算法（部分枚举方法）可以证明（1）线性规划问题的最优解如果存在，那么一定可以在可行域的极点上面找到；（2）方程的特解如果非负，则称为线性规划问题的一个基本可行解，任何一个基本可行解都对应一个极点，且若两个基本可行解只有一个基变量不一样，那么它们对应的一定是相邻的极点。所以，一种朴素的求解线性规划问题的方法就是枚举出所有的基本可行解，然后比较其对应目标函数值的大小，这其实就是枚举算法。但对于一个的系数矩阵A，最多能找到个基本可行解……它几乎是一个几何数级复杂的的算法，效率是非常低下的。          Fig1. 单纯性算法的几何直观...</div></div></div></a><a class="pagination-related" href="/posts/effed353/" title="Latex环境配置与模板"><img class="cover" src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Latex环境配置与模板/cover.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Latex环境配置与模板</div></div><div class="info-2"><div class="info-item-1">本文的内容主要是关于如何在sublime中配置latex写作环境，学习了怎么管理latex的包和使用别人做好的模板。</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/avatar3.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">syuansheng</div><div class="author-info-description">Life is a marathon!</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/YuanshengShe" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:13350003472@163.com" target="_blank" title="Mail2Me"><i class="fas fa-envelope" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://grs.dlmu.edu.cn/" target="_blank" title="DMU"><i class="fa-solid fa-building-columns" style="color: #hdhfbb;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">我是syuansheng，一名<font color='green'>交通运输规划与管理专业</font>的在读研究生。这是我的个人主页，我将在这里记录学习📚和生活🌈，同时我也期待得到一份<font color='blue'>航运相关的工作</font>， 如果你能够提供类似岗位或实习机会，请通过上方邮箱联系我！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Gurobi%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">Gurobi中一些基本的概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Gurobi%E5%BB%BA%E6%A8%A1%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.</span> <span class="toc-text">使用Gurobi建模的一般步骤</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E9%80%9F%E6%9F%A5"><span class="toc-number">3.</span> <span class="toc-text">操作速查</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%88%96%E4%BF%AE%E6%94%B9%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">获取或修改模型的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%88%96%E4%BF%AE%E6%94%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">3.2.</span> <span class="toc-text">获取或修改对象的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8quicksum%E5%87%BD%E6%95%B0%E5%92%8Ctupledict%E7%9A%84sum%E6%96%B9%E6%B3%95%E5%AE%8C%E6%88%90%E6%B1%82%E5%92%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">使用quicksum函数和tupledict的sum方法完成求和操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8GRB%E5%87%8F%E5%B0%91%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BF%86"><span class="toc-number">3.4.</span> <span class="toc-text">利用GRB减少不必要的记忆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E6%8F%92%E5%85%A5%E6%83%B0%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.5.</span> <span class="toc-text">通过回调函数插入惰性约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gurobi%E5%AE%9E%E7%8E%B0%E5%88%97%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95"><span class="toc-number">3.6.</span> <span class="toc-text">Gurobi实现列生成算法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/aca27b5/" title="多元函数的泰勒展开式"><img src="https://hub.gitmirror.com/raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/多元函数的泰勒展开式/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="多元函数的泰勒展开式"/></a><div class="content"><a class="title" href="/posts/aca27b5/" title="多元函数的泰勒展开式">多元函数的泰勒展开式</a><time datetime="2025-08-10T14:25:54.000Z" title="Created 2025-08-10 22:25:54">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/89db5cec/" title="最优化理论与方法初探"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/最优化理论与方法/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="最优化理论与方法初探"/></a><div class="content"><a class="title" href="/posts/89db5cec/" title="最优化理论与方法初探">最优化理论与方法初探</a><time datetime="2025-08-10T02:17:10.000Z" title="Created 2025-08-10 10:17:10">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/67b0a845/" title="论文阅读20250805"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/论文阅读/covers/1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="论文阅读20250805"/></a><div class="content"><a class="title" href="/posts/67b0a845/" title="论文阅读20250805">论文阅读20250805</a><time datetime="2025-08-05T11:11:33.000Z" title="Created 2025-08-05 19:11:33">2025-08-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/effed353/" title="Latex环境配置与模板"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Latex环境配置与模板/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Latex环境配置与模板"/></a><div class="content"><a class="title" href="/posts/effed353/" title="Latex环境配置与模板">Latex环境配置与模板</a><time datetime="2025-08-01T08:44:12.000Z" title="Created 2025-08-01 16:44:12">2025-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/36e200c/" title="gurobi速查手册"><img src="https://hub.gitmirror.com/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gurobi速查手册"/></a><div class="content"><a class="title" href="/posts/36e200c/" title="gurobi速查手册">gurobi速查手册</a><time datetime="2025-07-26T05:54:35.000Z" title="Created 2025-07-26 13:54:35">2025-07-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 By syuansheng</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="/js/Cherry blossoms fluttering.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="输入关键词…" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":1},"log":false});</script></body></html>
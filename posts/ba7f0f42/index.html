<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>一篇文章弄懂GUROBI基础操作 | syuansheng's blogs</title><meta name="author" content="syuansheng"><meta name="copyright" content="syuansheng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="通过一个案例快速回顾Gurobi相关的基础操作，持续整理相关细节。">
<meta property="og:type" content="article">
<meta property="og:title" content="一篇文章弄懂GUROBI基础操作">
<meta property="og:url" content="https://yuanshengshe.github.io/posts/ba7f0f42/index.html">
<meta property="og:site_name" content="syuansheng&#39;s blogs">
<meta property="og:description" content="通过一个案例快速回顾Gurobi相关的基础操作，持续整理相关细节。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%BC%84%E6%87%82GUROBI%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/cover.webp">
<meta property="article:published_time" content="2025-08-31T08:22:46.000Z">
<meta property="article:modified_time" content="2026-01-07T05:11:07.869Z">
<meta property="article:author" content="syuansheng">
<meta property="article:tag" content="优化技术">
<meta property="article:tag" content="Gurobi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%BC%84%E6%87%82GUROBI%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/cover.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "一篇文章弄懂GUROBI基础操作",
  "url": "https://yuanshengshe.github.io/posts/ba7f0f42/",
  "image": "https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/一篇文章弄懂GUROBI基础操作/cover.webp",
  "datePublished": "2025-08-31T08:22:46.000Z",
  "dateModified": "2026-01-07T05:11:07.869Z",
  "author": [
    {
      "@type": "Person",
      "name": "syuansheng",
      "url": "https://yuanshengshe.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/DMU.png"><link rel="canonical" href="https://yuanshengshe.github.io/posts/ba7f0f42/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":"ture","top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '一篇文章弄懂GUROBI基础操作',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/myfooter.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/mygradient.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="web_bg" style="background-image: url(https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/顶部图/wallhaven-7j37v3_1920x1080.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/avatar3.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">62</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> Blogs</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/datasets/"><i class="fa-fw fas fa-list"></i><span> Datasets</span></a></div><div class="menus_item"><a class="site-page" href="/abouts/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><!-- 左侧博客信息区域--><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">syuansheng's blogs</span></a><a class="nav-page-title" href="/"><span class="site-name">一篇文章弄懂GUROBI基础操作</span></a></span><!-- 新增的导航菜单容器（居中布局关键）--><div id="nav-menus-container"><!-- 菜单主体部分--><div id="menus"><!-- 搜索按钮--><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><!-- 菜单项--><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> Blogs</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/datasets/"><i class="fa-fw fas fa-list"></i><span> Datasets</span></a></div><div class="menus_item"><a class="site-page" href="/abouts/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div><!-- 移动端汉堡菜单按钮（保持原位置）--><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">一篇文章弄懂GUROBI基础操作</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-08-31T08:22:46.000Z" title="Created 2025-08-31 16:22:46">2025-08-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-07T05:11:07.869Z" title="Updated 2026-01-07 13:11:07">2026-01-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E4%B8%8E%E8%BF%90%E7%AD%B9%E5%AD%A6/">数学建模与运筹学</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>19mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Gurobi特有的数据结构"><a href="#Gurobi特有的数据结构" class="headerlink" title="Gurobi特有的数据结构"></a>Gurobi特有的数据结构</h1><p>在gurobi里面经常会和tuplelist和tupledict这两种数据结构打交道，理解他们是非常重要的。实际上tuplelist和tupledict分别继承于python的序列数据结构list和dict，所以list和dict的特点它俩都有，list和dict能做的操作tuplelist和tupledict都能做。<font color="blue">那tuplelist和tupledict存在的意义是什么？In which situation they are better than their father?</font>理解清楚这一点，tuplelist和tupledict就算是大致搞清楚了——在建模的时候，我们常常会有需要筛选出满足特定条件的下标，或者对满足特定条件的下标做运算。比如<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="18.137ex" height="2.363ex" role="img" focusable="false" viewBox="0 -750 8016.4 1044.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="munder"><g data-mml-node="mo"><path data-c="2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"></path></g><g data-mml-node="TeXAtom" transform="translate(1089,-285.4) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="msub" transform="translate(1549.6,0)"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(623,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2936.5,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(3381.1,0)"><path data-c="2200" d="M0 673Q0 684 7 689T20 694Q32 694 38 680T82 567L126 451H430L473 566Q483 593 494 622T512 668T519 685Q524 694 538 694Q556 692 556 674Q556 670 426 329T293 -15Q288 -22 278 -22T263 -15Q260 -11 131 328T0 673ZM414 410Q414 411 278 411T142 410L278 55L414 410Z"></path></g><g data-mml-node="mi" transform="translate(3937.1,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g><g data-mml-node="mo" transform="translate(4626.9,0)"><path data-c="2208" d="M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z"></path></g><g data-mml-node="mo" transform="translate(5571.7,0)"><path data-c="7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path></g><g data-mml-node="mn" transform="translate(6071.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(6571.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(7016.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(7516.4,0)"><path data-c="7D" d="M65 731Q65 745 68 747T88 750Q171 750 216 725T279 670Q288 649 289 635T291 501Q292 362 293 357Q306 312 345 291T417 269Q428 269 431 266T434 250T431 234T417 231Q380 231 345 210T298 157Q293 143 292 121T291 -28V-79Q291 -134 285 -156T256 -198Q202 -250 89 -250Q71 -250 68 -247T65 -230Q65 -224 65 -223T66 -218T69 -214T77 -213Q91 -213 108 -210T146 -200T183 -177T207 -139Q208 -134 209 3L210 139Q223 196 280 230Q315 247 330 250Q305 257 280 270Q225 304 212 352L210 362L209 498Q208 635 207 640Q195 680 154 696T77 713Q68 713 67 716T65 731Z"></path></g></g></g></svg></mjx-container>，如果我们用普通字典dict来存储变量x，要把这个表达式写出来，我们得先写个列表或生成器推导式对变量做筛选，然后再用全局函数quicksum对这些满足条件的变量求和。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>如果用普通字典存放变量</span></div><code class="language-python">quicksum<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但如果变量是用tupledict存储的，那么我们可以直接像下面这么写。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>如果用tupledict</span></div><code class="language-python">x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><font color="red">是不是一下子就简洁许多？这就是tuplelist和tupledict这两个数据结构设计的核心逻辑，总结一下，你只需要知道tuplelist和tupledict可以让我们快速实现筛选、求和等操作。具体而言，这两个数据结构在他们的爸爸list和dict的基础上额外实现了下面这些方法</font>。</p>
<ul>
<li>select(pattern)：对于tuplelist，返回满足pattern的所有元组构成的tuplelist，对于tupledict，返回满足pattern的所有变量及其对应索引构成的tupledict。置于这个pattern，取决于你的元组有多少个域，每个域都必须对应一个参数，如果参数是scalar就是精确匹配，如果是列表就是部分匹配，如果是*就表示任意匹配。</li>
<li>sum(pattern)：tuplelist没有这个方法，只有tupledict有，将满足特定模式的变量相加。</li>
<li>prod(coeff, pattern)：将满足pattern的变量和coeff挑出来相乘求和，注意coeff（一般用dict，将下标索引映射为某一个值）必须和调用prod的tupledict的结构（索引）一致。</li>
</ul>
<h1 id="Gurobi的常量、回调码、参数名、属性名和状态名记不住怎么办"><a href="#Gurobi的常量、回调码、参数名、属性名和状态名记不住怎么办" class="headerlink" title="Gurobi的常量、回调码、参数名、属性名和状态名记不住怎么办"></a>Gurobi的常量、回调码、参数名、属性名和状态名记不住怎么办</h1><p>Gurobi提供了一个GRB类专门用来解决这个困扰——<font color="red">怎么解决的呢？就是把一些不好记的常量或字符串用一个名字好记的变量（类属性和实例属性）存储起来</font>。GRB的类属性定义了一系列常量值对应变量，GRB的实例属性Callback中定义了常用的where和what码对应变量，Attr定义了常用属性字符串对应变量，Param定义了常用参数字符串对应变量。记这些类属性和实例属性的名字要比直接记忆数字或字符串容易一些，当然了，GRB包含的内容远不止于此，这块儿没法展开讲了，只能在使用的过程中不断积累常用的GRB中定义的变量（类属性和实例属性）。我在使用过程中常用的GRB类属性和实例属性：</p>
<ul>
<li>GRB.MINIMIZE</li>
<li>GRB.MAXIMIZE</li>
<li>GRB.CONTINUOUS</li>
<li>GRB.BINARY</li>
</ul>
<h1 id="Gurobi的Attribute和Parameter"><a href="#Gurobi的Attribute和Parameter" class="headerlink" title="Gurobi的Attribute和Parameter"></a>Gurobi的Attribute和Parameter</h1><p>个人认为在使用Gurobi时不要把把Parameter翻译为参数。传统地，在python里面我们把类中定义的变量（类属性和实例属性）叫做属性，把一个函数或方法需要接收的东西叫做参数。但在gurobi里面Parameter其实是不同的含义：Gurobi里面的Parameter在python语言的意义下讲其实还是属性（Model对象的Params属性的子属性），只不过这个属性的作用是控制求解器的行为。所以说要获取或修改Parameter就像获取或修改python中对象的属性那样操作就行了。</p>
<pre class="line-numbers language-none"><div class="caption"><span>获取和修改Parameter</span></div><code class="language-none">print(model.Params.参数名)
model.Params.参数名 = 新的参数值 # 求解策略参数的设置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>对于Gurobi中的Attribute就好理解了，它和python意义上的属性是一致的，同样可以通过下面的方法获取属性或修改属性。</p>
<pre class="line-numbers language-none"><div class="caption"><span>获取和修改属性</span></div><code class="language-none">print(某个gurobi对象.属性名)
某个gurobi对象.属性名 = 新的属性值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>一般来说Parameter不涉及批量获取或修改的操作，但是Attribute会涉及，这个时候使用上面的方法就非常慢了。Gurobi提供了getAttr、setAtrr方法实现批量属性获取或批量属性设置。</p>
<pre class="line-numbers language-none"><div class="caption"><span>批量获取和修改属性</span></div><code class="language-none">gurobi的模型对象.getAttr(属性名) # 获取模型对象的叫`属性名`的Attribute
gurobi的模型对象.getAttr(属性名，对象序列) # 批量获取对象序列叫`属性名`的属性值
gurobi的模型对象.setAttr(属性名，新属性值) # 设置模型对象的叫`属性名`的属性设置为新属性值
gurobi的模型对象.setAttr(属性名，对象序列，新属性值序列或一个标量) # 把对象序列中对象的`属性名`属性的值设置为新属性值序列中对应属性或统一设置为同一个值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>这块还是得积累，Attribute和Parameter太多了,我在使用过程中常用的Attribute和Parameter：</p>
<ul>
<li>Attribute<ul>
<li>模型对象.ModelName：当前模型的name。</li>
<li>模型对象.ObjVal：当前模型的找到的incumbent。</li>
<li>变量对象.VarName：变量对象的name。</li>
<li>变量对象.Start：变量的热启动值。</li>
<li>变量对象.X：变量的取值。</li>
</ul>
</li>
<li>Parameter<ul>
<li>ModelSense：控制模型的优化方向。</li>
<li>MIPFocus：求解器的求解重心。0是再找可行解和证明最优性取折中，1是侧重找可行解，2是侧重证明最优性，3是侧重bound的提升。</li>
<li>MIPGap：最优性容差，Gap小于这个值的时候求解器就终止了。</li>
<li>LogToConsole：是否将当前模型的求解信息输出到控制台。</li>
<li>LogFile：设置将日志文件输出到哪里。</li>
</ul>
</li>
</ul>
<h1 id="惰性约束和割平面"><a href="#惰性约束和割平面" class="headerlink" title="惰性约束和割平面"></a>惰性约束和割平面</h1><p>在说明如何在 Gurobi 中添加惰性约束和割平面之前，首先要介绍 Gurobi 的惰性更新机制和回调函数这两个概念。所谓惰性更新机制就是指用户对模型的任何更改都不会在对应代码被执行后立即完成。Gurobi此时的具体行为是将模型的修改放入一个等待队列，当且仅当——（1）update 方法被调用（2）optimize 方法被调用（3）write 方法被调用这三种情形中的任意一种被触发时模型的修改才会真正的被完成。Gurobi之所以使用惰性更新机制是因为对于求解器而言处理模型修改信息是非常耗时的，相较于修改一次就更新一次的方式，对多次修改集中更新有着更高的效率。回调函数是计算机科学领域的一个重要概念，通俗地讲就是在让函数 B 有能力完成某个定制化功能时将函数 A 作为参数传递给它，使得函数 B 在特定的条件下调用函数 A 完成定制化功能，传递给函数 B 的这个函数 A 就叫做回调函数。Gurobi 中也有这个概念，这使得我们可以在求解过程中实时查看模型的求解信息，甚至可以在求解过程中实时地修改模型的内容。在 python 中使用 Gurobi 的回调函数分为两步：</p>
<ol>
<li>定义回调函数 def func_name(model,where)并实现相应的功能</li>
<li>将自己定义的回调函数作为参数传递给 optimize 方法</li>
</ol>
<p>惰性约束和割平面约束正是基于惰性更新机制和回调函数实现的。前面提到，对于模型的任何修改都会在上述三种情形中任意一种被触发后完成，但惰性约束和割平<br>面约束是例外。即使上面讲的三种情形被触发，惰性约束和割平面约束也不会被加入到模型当中。也就是说 Gurobi在优化时使用的实际上是松弛了惰性约束和割平面模型，当且仅当求解器发现了新的可行解并且可行解不满足惰性约束或割平面约束时惰性约束和割平面约束才会被加入模型。基于这一特点，当面临大规模约束时，Gurobi不需要一次性添加所有约束，这可以大幅度提高模型求解的速度。</p>
<h1 id="一个例子弄清楚Gurobi的建模过程"><a href="#一个例子弄清楚Gurobi的建模过程" class="headerlink" title="一个例子弄清楚Gurobi的建模过程"></a>一个例子弄清楚Gurobi的建模过程</h1><h2 id="数学模型的建立"><a href="#数学模型的建立" class="headerlink" title="数学模型的建立"></a>数学模型的建立</h2><p><strong>索引和集合</strong></p>
<ul>
<li>depot：代指仓库。</li>
<li>virtual_depot：代指仓库，区分离开仓库和到达仓库。</li>
<li>O：需求的起点集合。</li>
<li>D：需求的终点集合。</li>
<li>K：可用车辆的集合。</li>
<li>V：网络中所有节点的集合。</li>
<li>A：网络中所有合法弧的集合。</li>
<li>demand：各个顾客节点的需求，正数为deliver，负数为pickup。</li>
<li>cordinate_x：各个节点的x坐标。</li>
<li>cordinate_y：各个节点的y坐标。</li>
<li>distance：合法弧之间的距离。</li>
</ul>
<p><strong>决策变量</strong></p>
<ul>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex;" xmlns="http://www.w3.org/2000/svg" width="4.416ex" height="1.666ex" role="img" focusable="false" viewBox="0 -442 1951.8 736.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(623,0)"><path data-c="1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path></g><g data-mml-node="mo" transform="translate(1035,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(1313,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container>：弧流变量，如果k车从i走到j那么它就取1。</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="3.808ex" height="2.242ex" role="img" focusable="false" viewBox="0 -704 1682.9 991.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="TeXAtom" transform="translate(824,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(623,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container>: 车辆k离开i节点之后车上的载重。</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="2.835ex" height="2.066ex" role="img" focusable="false" viewBox="0 -626 1252.9 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(623,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container>：车辆k到达i节点的时间。</li>
</ul>
<script type="math/tex; mode=display">
\text{Min} \quad \sum_{i}\sum_{j}\sum_{k}distance_{i,j}x_{i,j,k}</script><script type="math/tex; mode=display">
\begin{align}
% 1. 每个需求都必须被服务
& \text{(1)} \quad \sum_{j \in V} \sum_{k \in K} x_{ijk} = 1, & \forall i \in O \\
% 2. 车辆在i点pickup了就得在对应的n+i去deliver
& \text{(2)} \quad \sum_{j \in V} x_{ijk} = \sum_{j \in V} x_{(n+i)jk}, & \forall i \in O, \forall k \in K \\
% 3. 流平衡约束
& \text{(3.1)} \quad \sum_{j \in V} x_{\text{depot}jk} = 1, & \forall k \in K \\
& \text{(3.2)} \quad \sum_{i \in V} x_{i,\text{virtual\_depot},k} = 1, & \forall k \in K \\
& \text{(3.3)} \quad \sum_{j \in V} x_{ijk} = \sum_{j \in V} x_{jik}, & \forall i \in O \cup D, \forall k \in K \\
% 4. 时间连贯性约束
& \text{(4)} \quad t_{ik} + \text{distance}_{ij} - 9999(1 - x_{ijk}) \leq t_{jk}, & \forall (i,j) \in A, \forall k \in K \\
% 5. 先取货后送货
& \text{(5)} \quad t_{(n+i)k} - t_{ik} \geq \text{distance}_{i,n+i}, & \forall i \in O, \forall k \in K \\
% 6. 重量连贯性约束
& \text{(6)} \quad Q_{ik} + \text{demand}_j - 9999(1 - x_{ijk}) \leq Q_{jk}, & \forall (i,j) \in A, \forall k \in K \\
% 7. 载荷约束
& \text{(7.1)} \quad Q_{ik} \geq 0, & \forall i \in V, \forall k \in K \\
& \text{(7.2)} \quad Q_{ik} \geq \text{demand}_i, & \forall i \in V, \forall k \in K \\
& \text{(7.3)} \quad Q_{ik} \leq \text{capacity}, & \forall i \in V, \forall k \in K \\
& \text{(7.4)} \quad Q_{ik} \leq \text{capacity} + \text{demand}_i, & \forall i \in V, \forall k \in K
\end{align}</script><h2 id="使用Gurobi表达并求解这个模型的步骤"><a href="#使用Gurobi表达并求解这个模型的步骤" class="headerlink" title="使用Gurobi表达并求解这个模型的步骤"></a>使用Gurobi表达并求解这个模型的步骤</h2><p>(1) 创建一个Data类型，专门用来管理模型中涉及到的索引、集合和参数。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>pdpmodel.py</span></div><code class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt
<span class="token keyword">from</span> gurobipy <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""
	维护模型中涉及到的索引、集合和参数
	"""</span>
	<span class="token comment"># 索引</span>
	depot <span class="token operator">=</span> <span class="token number">0</span> 
	virtual_depot <span class="token operator">=</span> <span class="token boolean">None</span>
	<span class="token comment"># 集合</span>
	O <span class="token operator">=</span> <span class="token boolean">None</span>
	D <span class="token operator">=</span> <span class="token boolean">None</span>
	V <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token comment"># V=O+D+depot+virtual_depot</span>
	K <span class="token operator">=</span> <span class="token boolean">None</span>
	A <span class="token operator">=</span> <span class="token boolean">None</span>
	<span class="token comment"># 参数</span>
	capacity <span class="token operator">=</span> <span class="token boolean">None</span>
	demand <span class="token operator">=</span> <span class="token boolean">None</span>
	cordinate_x <span class="token operator">=</span> <span class="token boolean">None</span>
	cordinate_y <span class="token operator">=</span> <span class="token boolean">None</span>
	distance <span class="token operator">=</span> <span class="token boolean">None</span>

	<span class="token keyword">def</span> <span class="token function">_initialData</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span>filename<span class="token operator">=</span><span class="token string">'./1_1PDPdata.txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		这个函数里面就写你要怎么样初始话上方的数据
		"""</span>
		infolst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
			strlst <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
			flag <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment"># 当flag为True，就说明这一行是我们需要读取的信息</span>
			<span class="token keyword">for</span> line <span class="token keyword">in</span> strlst<span class="token punctuation">:</span>
				<span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">'CUST NO.  XCOORD.   YCOORD.    DEMAND   READY TIME  DUE DATE   SERVICE   TIME\n'</span><span class="token punctuation">:</span>
					flag <span class="token operator">=</span> <span class="token boolean">True</span>
					<span class="token keyword">continue</span>
				<span class="token keyword">if</span> flag <span class="token keyword">and</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token comment"># 开始解析数据</span>
					infolst<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token comment"># 开始初始化上方列出的数据</span>
		number_of_demand <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>infolst<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
		cls<span class="token punctuation">.</span>virtual_depot <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>number_of_demand<span class="token operator">+</span><span class="token number">1</span>
		cls<span class="token punctuation">.</span>O <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>number_of_demand<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		cls<span class="token punctuation">.</span>D <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number_of_demand<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>number_of_demand<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		cls<span class="token punctuation">.</span>V <span class="token operator">=</span> <span class="token punctuation">[</span>cls<span class="token punctuation">.</span>depot<span class="token punctuation">]</span><span class="token operator">+</span>cls<span class="token punctuation">.</span>O<span class="token operator">+</span>cls<span class="token punctuation">.</span>D<span class="token operator">+</span><span class="token punctuation">[</span>cls<span class="token punctuation">.</span>virtual_depot<span class="token punctuation">]</span>
		cls<span class="token punctuation">.</span>K <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		cls<span class="token punctuation">.</span>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> cls<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
			<span class="token keyword">for</span> j <span class="token keyword">in</span> cls<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
				<span class="token comment"># 像这种网络模型，先就把合法的弧筛选出来后面可以省很多事情</span>
				<span class="token comment"># （1）自环</span>
				<span class="token comment"># （2）回起点的弧、从终点出发的弧</span>
				<span class="token comment"># （3）一点到其自身虚拟节点的弧</span>
				<span class="token keyword">if</span> i <span class="token operator">==</span> j<span class="token punctuation">:</span>
					<span class="token keyword">continue</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> cls<span class="token punctuation">.</span>depot<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> cls<span class="token punctuation">.</span>virtual_depot<span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">continue</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> cls<span class="token punctuation">.</span>depot<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> cls<span class="token punctuation">.</span>virtual_depot<span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">continue</span>
				cls<span class="token punctuation">.</span>A<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
		cls<span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token number">100</span>
		cls<span class="token punctuation">.</span>demand<span class="token punctuation">,</span>cls<span class="token punctuation">.</span>cordinate_x<span class="token punctuation">,</span>cls<span class="token punctuation">.</span>cordinate_y<span class="token punctuation">,</span>cls<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>number_of_demand<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> i <span class="token operator">==</span> cls<span class="token punctuation">.</span>virtual_depot<span class="token punctuation">:</span>
				cls<span class="token punctuation">.</span>demand<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>cls<span class="token punctuation">.</span>depot<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
				cls<span class="token punctuation">.</span>cordinate_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>cls<span class="token punctuation">.</span>depot<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
				cls<span class="token punctuation">.</span>cordinate_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>cls<span class="token punctuation">.</span>depot<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				cls<span class="token punctuation">.</span>demand<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
				cls<span class="token punctuation">.</span>cordinate_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
				cls<span class="token punctuation">.</span>cordinate_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> infolst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> cls<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
			<span class="token keyword">for</span> j <span class="token keyword">in</span> cls<span class="token punctuation">.</span>V<span class="token punctuation">:</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span> <span class="token keyword">in</span> cls<span class="token punctuation">.</span>A<span class="token punctuation">:</span>
					cls<span class="token punctuation">.</span>distance<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>cls<span class="token punctuation">.</span>cordinate_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>cls<span class="token punctuation">.</span>cordinate_x<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>cls<span class="token punctuation">.</span>cordinate_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>cls<span class="token punctuation">.</span>cordinate_y<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">_consoleOutput</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		这里就写如何展示获取的信息，检查数据读取是否正确
		"""</span>
		messege <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"仓库索引"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
					<span class="token string">"需求起点集合"</span><span class="token punctuation">:</span>cls<span class="token punctuation">.</span>O<span class="token punctuation">,</span>
					<span class="token string">"需求终点集合"</span><span class="token punctuation">:</span>cls<span class="token punctuation">.</span>D<span class="token punctuation">,</span>
					<span class="token string">"网络包含的所有点的集合"</span><span class="token punctuation">:</span>cls<span class="token punctuation">.</span>V<span class="token punctuation">,</span>
					<span class="token string">"单车载重"</span><span class="token punctuation">:</span>cls<span class="token punctuation">.</span>capacity<span class="token punctuation">,</span>
					<span class="token string">"各点需求(正数deliver，负数pickup)"</span><span class="token punctuation">:</span>cls<span class="token punctuation">.</span>demand<span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token string">"集合和参数信息汇总表"</span><span class="token operator">+</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> key<span class="token punctuation">,</span>value <span class="token keyword">in</span> messege<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(2) 创建对应的Model类，这个Model类要继承于前面创建的Data类型，这样访问索引、集合和参数要方便一点——<font color="blue">比如，你不让Model类继承上面的Data类，而是把Data实例化之后作为Model的一个实例属性data，那么你在搭建模型的时候想要访问集合，比如说访问O，就要写成self.data.O。但如果使用继承的方式，那么就可以直接写成self.O。</font>此外，通过这个类的实例属性来管理模型对象和变量对象，并分别实现buildModel方法用于搭建模型，实现runModel方法设置模型的Parameters从而控制模型的行为并运行求解器，实现ouputFile方法把你觉得之后可以用来分析的文件给导出去。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>pdpmodel.py</span></div><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">PDPModel</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">"""
	这个类直接继承于Data，目的是使访问Data中定义的集合和参数更加简便
	"""</span>

	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># 完成数据初始化操作</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>PDPModel<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>_initialData<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token builtin">super</span><span class="token punctuation">(</span>PDPModel<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>_consoleOutput<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment"># 管理变量和辅助变量</span>
		self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token boolean">None</span>
		self<span class="token punctuation">.</span>Q <span class="token operator">=</span> <span class="token boolean">None</span>
		self<span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token boolean">None</span>
		<span class="token comment"># 模型对象管理</span>
		self<span class="token punctuation">.</span>model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token string">"PDP1_1"</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">buildModel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		这个方法用来搭建模型，
		（1）添加变量
		（2）添加目标函数
		（3）添加约束条件
		"""</span>
		<span class="token comment"># (1)</span>
		self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span>self<span class="token punctuation">.</span>A<span class="token punctuation">,</span>self<span class="token punctuation">.</span>K<span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>BINARY<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>Q <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">,</span>self<span class="token punctuation">.</span>K<span class="token punctuation">,</span>lb<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>ub<span class="token operator">=</span>self<span class="token punctuation">.</span>capacity<span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>CONTINUOUS<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Q'</span><span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>t <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addVars<span class="token punctuation">(</span>self<span class="token punctuation">.</span>V<span class="token punctuation">,</span>self<span class="token punctuation">.</span>K<span class="token punctuation">,</span>lb<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>vtype<span class="token operator">=</span>GRB<span class="token punctuation">.</span>CONTINUOUS<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'t'</span><span class="token punctuation">)</span>
		<span class="token comment"># (2)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setObjective<span class="token punctuation">(</span>
			quicksum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>distance<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>A <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			sense<span class="token operator">=</span>GRB<span class="token punctuation">.</span>MINIMIZE
			<span class="token punctuation">)</span>
		<span class="token comment"># (3)</span>
		<span class="token comment"># 1.每个需求都必须被服务</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>O<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs1'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 2.车辆在i点pickup了就得在对应的n+i去deliver</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>O<span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>O <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs2'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 3. 流平衡约束</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>depot<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs3_1'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>virtual_depot<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs3_2'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">==</span>self<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>O<span class="token operator">+</span>self<span class="token punctuation">.</span>D <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs3_3'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 4. 时间连贯性约束</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>t<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>distance<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">9999</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>t<span class="token punctuation">[</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>A <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs4'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 5. 先取货后送货</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>t<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>O<span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>t<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">&gt;=</span>self<span class="token punctuation">.</span>distance<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>O<span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>O <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs5'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 6. 重量连贯性约束</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>demand<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">9999</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> self<span class="token punctuation">.</span>A <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span>
			name <span class="token operator">=</span> <span class="token string">'constrs6'</span>
			<span class="token punctuation">)</span>
		<span class="token comment"># 7. 载荷约束</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>V <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span>
			<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'constrs7_1'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">&gt;=</span>self<span class="token punctuation">.</span>demand<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>V <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span>
			<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'constrs7_2'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>capacity <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>V <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span>
			<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'constrs7_3'</span>
			<span class="token punctuation">)</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>addConstrs<span class="token punctuation">(</span>
			<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token operator">&lt;=</span>self<span class="token punctuation">.</span>capacity<span class="token operator">+</span>self<span class="token punctuation">.</span>demand<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>V <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>K<span class="token punctuation">)</span>
			<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'constrs7_4'</span>
			<span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">runModel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		这个方法里面就来设置Parameter，控制求解器的行为，然后运行求解器
		"""</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>MIPFocus <span class="token operator">=</span> <span class="token number">3</span> 
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>NonConVex <span class="token operator">=</span> <span class="token number">2</span> 
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>params<span class="token punctuation">.</span>MIPGap <span class="token operator">=</span> <span class="token number">0</span> 
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>lazyConstraints <span class="token operator">=</span> <span class="token number">1</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>LogFile <span class="token operator">=</span> <span class="token string">'1_1pdpd.log'</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">ouputFile</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""
		这里就写你想导出哪些文件，如果只导出单一文件的话，也可以通过self.model.Params.ResultFile文件进行设置
		"""</span>
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'1_1pdpd.lp'</span><span class="token punctuation">)</span> 
		self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'1_1pdpd.sol'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
	pdpmodel <span class="token operator">=</span> PDPModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
	pdpmodel<span class="token punctuation">.</span>buildModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
	pdpmodel<span class="token punctuation">.</span>runModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
	pdpmodel<span class="token punctuation">.</span>ouputFile<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(3) 专门创建一个新的文件来分析求解结果，因为分析求解结果的过程涉及到反复调试代码，如果不单独开一个文件，那时间成本实在是太高了。</p>
<pre class="line-numbers language-python" data-language="python"><div class="caption"><span>analysis</span></div><code class="language-python"><span class="token keyword">from</span> numpy <span class="token keyword">import</span> zeros
<span class="token keyword">from</span> gurobipy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 全局read的作用是创建新模型对象	，模型对象read的作用是向现有模型添加信息</span>
model <span class="token operator">=</span> read<span class="token punctuation">(</span><span class="token string">'./1_1pdpd.lp'</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'./1_1pdpd.sol'</span><span class="token punctuation">)</span> <span class="token comment"># 把之前已经优化好的解读到变量的start属性中去，相当于做一个热启动，这样再去分析求解结果就会快很多</span>
model<span class="token punctuation">.</span>Params<span class="token punctuation">.</span>IterationLimit <span class="token operator">=</span> <span class="token number">1</span>
model<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 准备几个矩阵，存放决策变量的求解结果，方便后面分析</span>
x <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Q <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> var <span class="token keyword">in</span> model<span class="token punctuation">.</span>getVars<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> var<span class="token punctuation">.</span>VarName<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>var<span class="token punctuation">.</span>VarName<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		x<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> var<span class="token punctuation">.</span>X
	<span class="token keyword">if</span> var<span class="token punctuation">.</span>VarName<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'Q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		i<span class="token punctuation">,</span>k <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>var<span class="token punctuation">.</span>VarName<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> var<span class="token punctuation">.</span>X
	<span class="token keyword">if</span> var<span class="token punctuation">.</span>VarName<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		i<span class="token punctuation">,</span>k <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>var<span class="token punctuation">.</span>VarName<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> var<span class="token punctuation">.</span>X

<span class="token comment"># 根据弧流变量打印出各个车辆的路径</span>
<span class="token keyword">def</span> <span class="token function">printCarRoutes</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>depot<span class="token punctuation">)</span><span class="token punctuation">:</span>
	m<span class="token punctuation">,</span>n<span class="token punctuation">,</span>s <span class="token operator">=</span> x<span class="token punctuation">.</span>shape
	car_routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
		k_car_route <span class="token operator">=</span> <span class="token punctuation">[</span>depot<span class="token punctuation">]</span>
		<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> x<span class="token punctuation">[</span>k_car_route<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.1</span><span class="token punctuation">:</span>
				k_car_route<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
		car_routes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>k_car_route<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token string">'路径求解结果'</span><span class="token operator">+</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span>route <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>car_routes<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{}车的路径为:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> car_routes

car_routes <span class="token operator">=</span> printCarRoutes<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 打印其它类型变量的求解结果</span>
allQincar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	route <span class="token operator">=</span> car_routes<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
	Qincar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> route<span class="token punctuation">:</span>
		Qincar<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Q<span class="token punctuation">[</span>i<span class="token punctuation">,</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
	allQincar<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Qincar<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token string">'沿途载重情况'</span><span class="token operator">+</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span>Qincar <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>allQincar<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{}车的载重情况为:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>Qincar<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<center>
        <img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/一篇文章弄懂GUROBI基础操作/1.png" weight="50%" height="50%">
</center>

<h1 id="Gurobi证书过期处理方法"><a href="#Gurobi证书过期处理方法" class="headerlink" title="Gurobi证书过期处理方法"></a>Gurobi证书过期处理方法</h1><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wengkebiao/article/details/128092906">https://blog.csdn.net/wengkebiao/article/details/128092906</a></p>
<pre class="line-numbers language-dash" data-language="dash"><div class="caption"><span>遇到报错</span></div><code class="language-dash">Set parameter Username
Set parameter LicenseID to value 2603509
Traceback (most recent call last):
  File "D:\code repository\项目\LRHeuristics\example.py", line 11, in &lt;module&gt;
    lgmodel = Model("拉格朗日松弛模型")
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "src\\gurobipy\\_model.pyx", line 146, in gurobipy._model.Model.__init__
  File "src\\gurobipy\\gurobi.pxi", line 60, in gurobipy._core.gurobi._getdefaultenv
  File "src\\gurobipy\\env.pxi", line 88, in gurobipy._core.Env.__init__
gurobipy._exception.GurobiError: License expired 2025-12-25
[Finished in 5.7s]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重新更新证书，两步就ok了：</p>
<ol>
<li>上gurobi官网，点那个Named-User Academic获取命令输入到cmd当中重写获得许可证.lic文件</li>
</ol>
<center>
        <img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/一篇文章弄懂GUROBI基础操作/2.png" weight="50%" height="50%">
</center>

<pre class="line-numbers language-dash" data-language="dash"><div class="caption"><span>获取lic文件</span></div><code class="language-dash">PS C:\&gt; grbgetkey xxxx官网会给你一个码
info  : grbgetkey version 12.0.0, build v12.0.0rc1
info  : Platform is win64 (windows) - Windows 11.0 (26100.2)
info  : Contacting Gurobi license server...
info  : License file for license ID 2759492 was successfully retrieved
info  : License expires at the end of the day on 2026-12-27
info  : Saving license file...

In which directory would you like to store the Gurobi license file?
[hit Enter to store it in C:\Users\sheyu]: C:\gurobi

A license file already exists in 'C:\gurobi\gurobi.lic'
Continue? [Y/n] y

info  : License 2759492 written to file C:\gurobi\gurobi.lic
info  : You may have saved the license key to a non-default location
info  : You need to set the environment variable GRB_LICENSE_FILE before you can use this license key
info  : GRB_LICENSE_FILE=C:\gurobi\gurobi.lic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li>在系统变量中加上GRB_LICENSE_FILE，值设置为你新拿到的.lic文件的地址</li>
</ol>
<center>
        <img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/一篇文章弄懂GUROBI基础操作/3.png" weight="50%" height="50%">
</center>

<h1 id="模型infeasible调试方法"><a href="#模型infeasible调试方法" class="headerlink" title="模型infeasible调试方法"></a>模型infeasible调试方法</h1><ol>
<li>用computeIIS方法找出Irreducible Inconsistent Subsystem，</li>
</ol>
<pre class="line-numbers language-python调用computeIIS方法" data-language="python调用computeIIS方法"><code class="language-python调用computeIIS方法">你的模型.computeIIS()
你的模型.write('xxx.ils')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol>
<li>逐行注释，再添加会约束，定位到哪类约束存在问题</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://YuanshengShe.github.io">syuansheng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://yuanshengshe.github.io/posts/ba7f0f42/">https://yuanshengshe.github.io/posts/ba7f0f42/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF/">优化技术</a><a class="post-meta__tags" href="/tags/Gurobi/">Gurobi</a></div><div class="post-share"><div class="social-share" data-image="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/一篇文章弄懂GUROBI基础操作/cover.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>点这里请我喝杯咖啡吧！</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/wechatreceive.jpg" target="_blank"><img class="post-qr-code-img" src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/wechatreceive.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/e7a2c8be/" title="论文阅读20250816"><img class="cover" src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/论文阅读/covers/2.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">论文阅读20250816</div></div><div class="info-2"><div class="info-item-1">题目：《Containership routing with time deadlines and simultaneous deliveries and pick-ups》 作者：Matthew G. Karlaftis, Konstantinos Kepaptsoglou, Evangelos Sambracos。</div></div></div></a><a class="pagination-related" href="/posts/e671679d/" title="D-W分解与列生成算法"><img class="cover" src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/DW分解与列生成/cover.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">D-W分解与列生成算法</div></div><div class="info-2"><div class="info-item-1">本文总结了运筹学三大分解方法之一的Dantzig-Wolfe分解，以及如何使用列生成算法求解使用D-W分解得到的模型</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/ebfd4112/" title="2025年秋现代优化技术"><img class="cover" src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/2025年秋现代优化技术/cover.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-20</div><div class="info-item-2">2025年秋现代优化技术</div></div><div class="info-2"><div class="info-item-1">现代优化技术课程期末考点整理</div></div></div></a><a class="pagination-related" href="/posts/36e200c/" title="gurobi速查手册"><img class="cover" src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/Gurobi速查手册/cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-26</div><div class="info-item-2">gurobi速查手册</div></div><div class="info-2"><div class="info-item-1">整理实践过程中gurobi中相关操作。</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/avatar3.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">syuansheng</div><div class="author-info-description">Life is a marathon!</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">62</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/YuanshengShe" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:13350003472@163.com" target="_blank" title="Mail2Me"><i class="fas fa-envelope" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://grs.dlmu.edu.cn/" target="_blank" title="DMU"><i class="fa-solid fa-building-columns" style="color: #hdhfbb;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">我是syuansheng，一名<font color='green'>交通运输规划与管理专业</font>的在读研究生。这是我的个人主页，我将在这里记录学习📚和生活🌈，同时我也期待得到一份<font color='blue'>供应链、物流或航运相关的工作</font>，如果你能够提供类似岗位或实习机会，请通过上方邮箱联系我！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Gurobi%E7%89%B9%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">Gurobi特有的数据结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gurobi%E7%9A%84%E5%B8%B8%E9%87%8F%E3%80%81%E5%9B%9E%E8%B0%83%E7%A0%81%E3%80%81%E5%8F%82%E6%95%B0%E5%90%8D%E3%80%81%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E7%8A%B6%E6%80%81%E5%90%8D%E8%AE%B0%E4%B8%8D%E4%BD%8F%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="toc-number">2.</span> <span class="toc-text">Gurobi的常量、回调码、参数名、属性名和状态名记不住怎么办</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gurobi%E7%9A%84Attribute%E5%92%8CParameter"><span class="toc-number">3.</span> <span class="toc-text">Gurobi的Attribute和Parameter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%83%B0%E6%80%A7%E7%BA%A6%E6%9D%9F%E5%92%8C%E5%89%B2%E5%B9%B3%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">惰性约束和割平面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90%E5%BC%84%E6%B8%85%E6%A5%9AGurobi%E7%9A%84%E5%BB%BA%E6%A8%A1%E8%BF%87%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">一个例子弄清楚Gurobi的建模过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">数学模型的建立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Gurobi%E8%A1%A8%E8%BE%BE%E5%B9%B6%E6%B1%82%E8%A7%A3%E8%BF%99%E4%B8%AA%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.2.</span> <span class="toc-text">使用Gurobi表达并求解这个模型的步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gurobi%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">Gurobi证书过期处理方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8Binfeasible%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">模型infeasible调试方法</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1e4ed4a7/" title="dataclass装饰器"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/海大的四季/海大四季封面.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="dataclass装饰器"/></a><div class="content"><a class="title" href="/posts/1e4ed4a7/" title="dataclass装饰器">dataclass装饰器</a><time datetime="2026-01-15T12:57:55.000Z" title="Created 2026-01-15 20:57:55">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ebfd4112/" title="2025年秋现代优化技术"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/2025年秋现代优化技术/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2025年秋现代优化技术"/></a><div class="content"><a class="title" href="/posts/ebfd4112/" title="2025年秋现代优化技术">2025年秋现代优化技术</a><time datetime="2025-12-20T07:46:33.000Z" title="Created 2025-12-20 15:46:33">2025-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/746d3edf/" title="深度学习框架"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/深度学习框架/1x1卷积的作用(加速).png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深度学习框架"/></a><div class="content"><a class="title" href="/posts/746d3edf/" title="深度学习框架">深度学习框架</a><time datetime="2025-11-18T02:35:47.000Z" title="Created 2025-11-18 10:35:47">2025-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/581e93f8/" title="实验室报销流程"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/海大的四季/海大1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实验室报销流程"/></a><div class="content"><a class="title" href="/posts/581e93f8/" title="实验室报销流程">实验室报销流程</a><time datetime="2025-11-14T09:55:47.000Z" title="Created 2025-11-14 17:55:47">2025-11-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/532cc34d/" title="健身计划"><img src="https://gh.llkk.cc/https://raw.githubusercontent.com/YuanshengShe/YuanshengShe.github.io/main/images/健身计划/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="健身计划"/></a><div class="content"><a class="title" href="/posts/532cc34d/" title="健身计划">健身计划</a><time datetime="2025-11-07T11:09:13.000Z" title="Created 2025-11-07 19:09:13">2025-11-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By syuansheng</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="/js/Cherry blossoms fluttering.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="输入关键词…" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":1},"log":false});</script></body></html>